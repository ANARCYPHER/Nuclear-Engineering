"""core.py

Provides a container class for BEAVRS core lattice

"""

import beavrs.constants as c
from beavrs.corebuilder import TemplatedLattice

class Core(object):

    core_lattice_template = [
        ['dummy', 'dummy', 'dummy', 'dummy', 'dummy', 'dummy', 'dummy', 'dummy', 'dummy', 'dummy', 'dummy', 'dummy', 'dummy', 'dummy', 'dummy', 'dummy', 'dummy', 'dummy', 'dummy'],
        ['dummy', 'dummy', 'dummy', 'dummy', 'dummy', 'bafnw', 'bafn_', 'bafn_', 'bafn_', 'bafn_', 'bafn_', 'bafn_', 'bafn_', 'bafne', 'dummy', 'dummy', 'dummy', 'dummy', 'dummy'],
        ['dummy', 'dummy', 'dummy', 'bafnw', 'bafn_', 'bfcnw', 'L___1', 'K___1', 'J___1', 'H___1', 'G___1', 'F___1', 'E___1', 'bfcne', 'bafn_', 'bafne', 'dummy', 'dummy', 'dummy'],
        ['dummy', 'dummy', 'bafnw', 'bfcnw', 'N___2', 'M___2', 'L___2', 'K___2', 'J___2', 'H___2', 'G___2', 'F___2', 'E___2', 'D___2', 'C___2', 'bfcne', 'bafne', 'dummy', 'dummy'],
        ['dummy', 'dummy', 'bafw_', 'P___3', 'N___3', 'M___3', 'L___3', 'K___3', 'J___3', 'H___3', 'G___3', 'F___3', 'E___3', 'D___3', 'C___3', 'B___3', 'bafe_', 'dummy', 'dummy'],
        ['dummy', 'bafnw', 'bfcnw', 'P___4', 'N___4', 'M___4', 'L___4', 'K___4', 'J___4', 'H___4', 'G___4', 'F___4', 'E___4', 'D___4', 'C___4', 'B___4', 'bfcne', 'bafne', 'dummy'],
        ['dummy', 'bafw_', 'R___5', 'P___5', 'N___5', 'M___5', 'L___5', 'K___5', 'J___5', 'H___5', 'G___5', 'F___5', 'E___5', 'D___5', 'C___5', 'B___5', 'A___5', 'bafe_', 'dummy'],
        ['dummy', 'bafw_', 'R___6', 'P___6', 'N___6', 'M___6', 'L___6', 'K___6', 'J___6', 'H___6', 'G___6', 'F___6', 'E___6', 'D___6', 'C___6', 'B___6', 'A___6', 'bafe_', 'dummy'],
        ['dummy', 'bafw_', 'R___7', 'P___7', 'N___7', 'M___7', 'L___7', 'K___7', 'J___7', 'H___7', 'G___7', 'F___7', 'E___7', 'D___7', 'C___7', 'B___7', 'A___7', 'bafe_', 'dummy'],
        ['dummy', 'bafw_', 'R___8', 'P___8', 'N___8', 'M___8', 'L___8', 'K___8', 'J___8', 'H___8', 'G___8', 'F___8', 'E___8', 'D___8', 'C___8', 'B___8', 'A___8', 'bafe_', 'dummy'],
        ['dummy', 'bafw_', 'R___9', 'P___9', 'N___9', 'M___9', 'L___9', 'K___9', 'J___9', 'H___9', 'G___9', 'F___9', 'E___9', 'D___9', 'C___9', 'B___9', 'A___9', 'bafe_', 'dummy'],
        ['dummy', 'bafw_', 'R__10', 'P__10', 'N__10', 'M__10', 'L__10', 'K__10', 'J__10', 'H__10', 'G__10', 'F__10', 'E__10', 'D__10', 'C__10', 'B__10', 'A__10', 'bafe_', 'dummy'],
        ['dummy', 'bafw_', 'R__11', 'P__11', 'N__11', 'M__11', 'L__11', 'K__11', 'J__11', 'H__11', 'G__11', 'F__11', 'E__11', 'D__11', 'C__11', 'B__11', 'A__11', 'bafe_', 'dummy'],
        ['dummy', 'bafsw', 'bfcsw', 'P__12', 'N__12', 'M__12', 'L__12', 'K__12', 'J__12', 'H__12', 'G__12', 'F__12', 'E__12', 'D__12', 'C__12', 'B__12', 'bfcse', 'bafse', 'dummy'],
        ['dummy', 'dummy', 'bafw_', 'P__13', 'N__13', 'M__13', 'L__13', 'K__13', 'J__13', 'H__13', 'G__13', 'F__13', 'E__13', 'D__13', 'C__13', 'B__13', 'bafe_', 'dummy', 'dummy'],
        ['dummy', 'dummy', 'bafsw', 'bfcsw', 'N__14', 'M__14', 'L__14', 'K__14', 'J__14', 'H__14', 'G__14', 'F__14', 'E__14', 'D__14', 'C__14', 'bfcse', 'bafse', 'dummy', 'dummy'],
        ['dummy', 'dummy', 'dummy', 'bafsw', 'bafs_', 'bfcsw', 'L__15', 'K__15', 'J__15', 'H__15', 'G__15', 'F__15', 'E__15', 'bfcse', 'bafs_', 'bafse', 'dummy', 'dummy', 'dummy'],
        ['dummy', 'dummy', 'dummy', 'dummy', 'dummy', 'bafsw', 'bafs_', 'bafs_', 'bafs_', 'bafs_', 'bafs_', 'bafs_', 'bafs_', 'bafse', 'dummy', 'dummy', 'dummy', 'dummy', 'dummy'],
        ['dummy', 'dummy', 'dummy', 'dummy', 'dummy', 'dummy', 'dummy', 'dummy', 'dummy', 'dummy', 'dummy', 'dummy', 'dummy', 'dummy', 'dummy', 'dummy', 'dummy', 'dummy', 'dummy']
    ]

    core_positions = [  'F__14', 'F__15', 'F__12', 'F__13', 'F__10', 'F__11',
        'H___1', 'G___1', 'G___3', 'G___2', 'G___5', 'G___4', 'G___7', 'G___6',
        'G___9', 'G___8', 'F___1', 'F___2', 'F___3', 'F___4', 'F___5', 'F___6',
        'F___7', 'F___8', 'F___9', 'R___8', 'R___9', 'R___5', 'R___6', 'R___7',
        'P__10', 'P__11', 'P__12', 'P__13', 'H__10', 'H__11', 'H__12', 'H__13',
        'H__14', 'H__15', 'B__12', 'B__13', 'B__10', 'B__11', 'D__14', 'D__10',
        'D__11', 'D__12', 'D__13', 'K___5', 'K___4', 'K___7', 'K___6', 'K___1',
        'K___3', 'K___2', 'K___9', 'K___8', 'L___8', 'L___9', 'L___2', 'L___3',
        'L___1', 'L___6', 'L___7', 'L___4', 'L___5', 'C___9', 'C___8', 'C___5',
        'C___4', 'C___7', 'C___6', 'C___3', 'C___2', 'H___6', 'M__11', 'H___4',
        'H___5', 'H___2', 'H___3', 'P___7', 'M__13', 'H___8', 'H___9', 'M__12',
        'M__14', 'C__14', 'C__13', 'C__12', 'C__11', 'C__10', 'B___8', 'B___9',
        'B___4', 'B___5', 'B___6', 'B___7', 'B___3', 'R__10', 'R__11', 'H___7',
        'E__11', 'E__10', 'E__13', 'E__12', 'E__15', 'E__14', 'P___8', 'P___9',
        'P___6', 'M__10', 'P___4', 'P___5', 'P___3', 'E___3', 'E___2', 'E___1',
        'E___7', 'E___6', 'E___5', 'E___4', 'E___9', 'E___8', 'L__14', 'L__15',
        'L__10', 'L__11', 'L__12', 'L__13', 'G__13', 'G__12', 'G__11', 'G__10',
        'G__15', 'G__14', 'A__11', 'A__10', 'J__12', 'J__13', 'J__10', 'J__11',
        'J__14', 'J__15', 'N___8', 'N___9', 'N__14', 'N__12', 'N__13', 'N__10',
        'N__11', 'N___2', 'N___3', 'N___4', 'N___5', 'N___6', 'N___7', 'D___2',
        'D___3', 'D___6', 'D___7', 'D___4', 'D___5', 'D___8', 'D___9', 'M___9',
        'M___8', 'M___3', 'M___2', 'M___7', 'M___6', 'M___5', 'M___4', 'A___9',
        'A___8', 'A___7', 'A___6', 'A___5', 'J___4', 'J___5', 'J___6', 'J___7',
        'J___1', 'J___2', 'J___3', 'J___8', 'J___9', 'K__15', 'K__14', 'K__13',
        'K__12', 'K__11', 'K__10']

    def __init__(self, pincells, assemblies, baffle, is_symmetric=False):
        """ Creates BEAVRS core lattice universe """

        self.pins = pincells
        self.assem = assemblies
        self.baffle = baffle
        self.is_symmetric = is_symmetric

        self._set_enrichment_positions()
        self._set_instrument_tube_positions()
        self._set_bpra_positions()
        self._set_rcca_positions()
        self._make_core_universe()

    def _set_enrichment_positions(self):
        """ Sets the specification for BEAVRS assembly enrichment positions """

        self.enr_positions ={
                                                                          'L___1': '3.1%', 'K___1': '3.1%', 'J___1': '3.1%', 'H___1': '3.1%', 'G___1': '3.1%', 'F___1': '3.1%', 'E___1': '3.1%',
                                        'N___2': '3.1%', 'M___2': '3.1%', 'L___2': '3.1%', 'K___2': '1.6%', 'J___2': '3.1%', 'H___2': '1.6%', 'G___2': '3.1%', 'F___2': '1.6%', 'E___2': '3.1%', 'D___2': '3.1%', 'C___2': '3.1%',
                       'P___3': '3.1%', 'N___3': '3.1%', 'M___3': '2.4%', 'L___3': '1.6%', 'K___3': '2.4%', 'J___3': '1.6%', 'H___3': '2.4%', 'G___3': '1.6%', 'F___3': '2.4%', 'E___3': '1.6%', 'D___3': '2.4%', 'C___3': '3.1%', 'B___3': '3.1%',
                       'P___4': '3.1%', 'N___4': '2.4%', 'M___4': '2.4%', 'L___4': '2.4%', 'K___4': '1.6%', 'J___4': '2.4%', 'H___4': '1.6%', 'G___4': '2.4%', 'F___4': '1.6%', 'E___4': '2.4%', 'D___4': '2.4%', 'C___4': '2.4%', 'B___4': '3.1%',
      'R___5': '3.1%', 'P___5': '3.1%', 'N___5': '1.6%', 'M___5': '2.4%', 'L___5': '1.6%', 'K___5': '2.4%', 'J___5': '1.6%', 'H___5': '2.4%', 'G___5': '1.6%', 'F___5': '2.4%', 'E___5': '1.6%', 'D___5': '2.4%', 'C___5': '1.6%', 'B___5': '3.1%', 'A___5': '3.1%',
      'R___6': '3.1%', 'P___6': '1.6%', 'N___6': '2.4%', 'M___6': '1.6%', 'L___6': '2.4%', 'K___6': '1.6%', 'J___6': '2.4%', 'H___6': '1.6%', 'G___6': '2.4%', 'F___6': '1.6%', 'E___6': '2.4%', 'D___6': '1.6%', 'C___6': '2.4%', 'B___6': '1.6%', 'A___6': '3.1%',
      'R___7': '3.1%', 'P___7': '3.1%', 'N___7': '1.6%', 'M___7': '2.4%', 'L___7': '1.6%', 'K___7': '2.4%', 'J___7': '1.6%', 'H___7': '2.4%', 'G___7': '1.6%', 'F___7': '2.4%', 'E___7': '1.6%', 'D___7': '2.4%', 'C___7': '1.6%', 'B___7': '3.1%', 'A___7': '3.1%',
      'R___8': '3.1%', 'P___8': '1.6%', 'N___8': '2.4%', 'M___8': '1.6%', 'L___8': '2.4%', 'K___8': '1.6%', 'J___8': '2.4%', 'H___8': '1.6%', 'G___8': '2.4%', 'F___8': '1.6%', 'E___8': '2.4%', 'D___8': '1.6%', 'C___8': '2.4%', 'B___8': '1.6%', 'A___8': '3.1%',
      'R___9': '3.1%', 'P___9': '3.1%', 'N___9': '1.6%', 'M___9': '2.4%', 'L___9': '1.6%', 'K___9': '2.4%', 'J___9': '1.6%', 'H___9': '2.4%', 'G___9': '1.6%', 'F___9': '2.4%', 'E___9': '1.6%', 'D___9': '2.4%', 'C___9': '1.6%', 'B___9': '3.1%', 'A___9': '3.1%',
      'R__10': '3.1%', 'P__10': '1.6%', 'N__10': '2.4%', 'M__10': '1.6%', 'L__10': '2.4%', 'K__10': '1.6%', 'J__10': '2.4%', 'H__10': '1.6%', 'G__10': '2.4%', 'F__10': '1.6%', 'E__10': '2.4%', 'D__10': '1.6%', 'C__10': '2.4%', 'B__10': '1.6%', 'A__10': '3.1%',
      'R__11': '3.1%', 'P__11': '3.1%', 'N__11': '1.6%', 'M__11': '2.4%', 'L__11': '1.6%', 'K__11': '2.4%', 'J__11': '1.6%', 'H__11': '2.4%', 'G__11': '1.6%', 'F__11': '2.4%', 'E__11': '1.6%', 'D__11': '2.4%', 'C__11': '1.6%', 'B__11': '3.1%', 'A__11': '3.1%',
                       'P__12': '3.1%', 'N__12': '2.4%', 'M__12': '2.4%', 'L__12': '2.4%', 'K__12': '1.6%', 'J__12': '2.4%', 'H__12': '1.6%', 'G__12': '2.4%', 'F__12': '1.6%', 'E__12': '2.4%', 'D__12': '2.4%', 'C__12': '2.4%', 'B__12': '3.1%',
                       'P__13': '3.1%', 'N__13': '3.1%', 'M__13': '2.4%', 'L__13': '1.6%', 'K__13': '2.4%', 'J__13': '1.6%', 'H__13': '2.4%', 'G__13': '1.6%', 'F__13': '2.4%', 'E__13': '1.6%', 'D__13': '2.4%', 'C__13': '3.1%', 'B__13': '3.1%',
                                        'N__14': '3.1%', 'M__14': '3.1%', 'L__14': '3.1%', 'K__14': '1.6%', 'J__14': '3.1%', 'H__14': '1.6%', 'G__14': '3.1%', 'F__14': '1.6%', 'E__14': '3.1%', 'D__14': '3.1%', 'C__14': '3.1%',
                                                                          'L__15': '3.1%', 'K__15': '3.1%', 'J__15': '3.1%', 'H__15': '3.1%', 'G__15': '3.1%', 'F__15': '3.1%', 'E__15': '3.1%',
        }


    def _set_instrument_tube_positions(self):
        """ Sets the specification for BEAVRS instrument tube positions """

        self.instr_positions = {
                                                                           'J___1': 1,                         'F___1': 1,
                           'N___2': 1,                         'K___2': 1,             'H___2': 1,
                                                                                       'H___3': 1,             'F___3': 1,             'D___3': 1,             'B___3': 1,
               'P___4': 1, 'N___4': 1,                                                 'H___4': 1,
                                                   'L___5': 1,                                     'G___5': 1,             'E___5': 1,             'C___5': 1,
   'R___6': 1,             'N___6': 1,                         'K___6': 1,             'H___6': 1,                                                             'B___6': 1,
                                       'M___7': 1,                         'J___7': 1,                         'F___7': 1,                         'C___7': 1,
   'R___8': 1,             'N___8': 1,             'L___8': 1,             'J___8': 1,                         'F___8': 1,             'D___8': 1, 'C___8': 1, 'B___8': 1,
               'P___9': 1,                                                                         'G___9': 1,             'E___9': 1,                                     'A___9': 1,
                                                   'L__10': 1,             'J__10': 1,                                                 'D__10': 1,
   'R__11': 1,                                     'L__11': 1,                         'H__11': 1,                         'E__11': 1,                                     'A__11': 1,
                                                               'K__12': 1,                         'G__12': 1,                         'D__12': 1,
                           'N__13': 1,             'L__13': 1,                         'H__13': 1,                                                             'B__13': 1,
                           'N__14': 1,                                     'J__14': 1,                         'F__14': 1,             'D__14': 1,
                                                   'L__15': 1,                         'H__15': 1
        }


    def _set_bpra_positions(self):
        """ Sets the specification for BEAVRS BPRA positions """

        self.ba_positions = {
                                                                                   'K___1': '6S',                'H___1': '6S',                'F___1': '6S',
                                                                    'L___2': '16',                'J___2': '20',                'G___2': '20',                'E___2': '16',
                                    'N___3': '15SE', 'M___3': '16',                'K___3': '16',                'H___3': '16',                'F___3': '16',                'D___3': '16', 'C___3': '15SW',
                                    'N___4': '16',                  'L___4': '16',                'J___4': '12',                'G___4': '12',                'E___4': '16',                'C___4': '16',
                     'P___5': '16',                  'M___5': '16',                'K___5': '12',                'H___5': '12',                'F___5': '12',                'D___5': '16',                  'B___5': '16',
      'R___6': '6E',                'N___6': '16',                  'L___6': '12',                'J___6': '12',                'G___6': '12',                'E___6': '12',                'C___6': '16',                  'A___6': '6W',
                     'P___7': '20',                  'M___7': '12',                'K___7': '12',                'H___7': '16',                'F___7': '12',                'D___7': '12',                  'B___7': '20',
      'R___8': '6E',                'N___8': '16',                  'L___8': '12',                'J___8': '16',                'G___8': '16',                'E___8': '12',                'C___8': '16',                  'A___8': '6W',
                     'P___9': '20',                  'M___9': '12',                'K___9': '12',                'H___9': '16',                'F___9': '12',                'D___9': '12',                  'B___9': '20',
      'R__10': '6E',                'N__10': '16',                  'L__10': '12',                'J__10': '12',                'G__10': '12',                'E__10': '12',                'C__10': '16',                  'A__10': '6W',
                     'P__11': '16',                  'M__11': '16',                'K__11': '12',                'H__11': '12',                'F__11': '12',                'D__11': '16',                  'B__11': '16',
                                    'N__12': '16',                  'L__12': '16',                'J__12': '12',                'G__12': '12',                'E__12': '16',                'C__12': '16',
                                    'N__13': '15NE', 'M__13': '16',                'K__13': '16',                'H__13': '16',                'F__13': '16',                'D__13': '16', 'C__13': '15NW',
                                                                    'L__14': '16',                'J__14': '20',                'G__14': '20',                'E__14': '16',
                                                                                   'K__15': '6N',                'H__15': '6N',                'F__15': '6N',
        }

    def _set_rcca_positions(self):
        """ Sets the specification for BEAVRS RCCA positions """

        self.rcca_positions = {
                                                 'M___2': 'SA',                'K___2': 'B',                'H___2':  'C',                'F___2': 'B',                'D___2': 'SA',
                                                                'L___3': 'SD',               'J___3': 'SB',                'G___3': 'SB',               'E___3': 'SC',
                   'P___4': 'SA',                'M___4':  'D',                                             'H___4': 'SE',                                             'D___4':  'D',                'B___4': 'SA',
                                  'N___5': 'SC',                                                                                                                                      'C___5': 'SD',
                   'P___6':  'B',                                              'K___6': 'C',                'H___6':  'A',                'F___6': 'C',                                              'B___6': 'B',
                                  'N___7': 'SB',                                                                                                                                      'C___7': 'SB',
                   'P___8':  'C',                'M___8': 'SE',                'K___8': 'A',                'H___8':  'D',                'F___8': 'A',                'D___8': 'SE',                'B___8': 'C',
                                  'N___9': 'SB',                                                                                                                                      'C___9': 'SB',
                   'P__10':  'B',                                              'K__10': 'C',                'H__10':  'A',                'F__10': 'C',                                              'B__10': 'B',
                                  'N__11': 'SD',                                                                                                                                      'C__11': 'SC',
                   'P__12': 'SA',                'M__12':  'D',                                             'H__12': 'SE',                                             'D__12':  'D',                'B__12': 'SA',
                                                                'L__13': 'SC',               'J__13': 'SB',                'G__13': 'SB',               'E__13': 'SD',
                                                 'M__14': 'SA',                'K__14': 'B',                'H__14':  'C',                'F__14': 'B',                'D__14': 'SA',
        }


    def _make_core_universe(self):
        """ Creates the BEAVRS core lattice universe """

        lattice = TemplatedLattice(name='Core Lattice')
        lattice.setTemplate(self.core_lattice_template)
        lattice.pitch = [c.latticePitch, c.latticePitch]
        lattice.lower_left = [-19.*c.latticePitch/2., -19.*c.latticePitch/2.]
        lattice.updatePositions(self.baffle.universes)
        lattice.setPosition('dummy', self.pins.u_waterPin)
        for pos in self.core_positions:
            enr = self.enr_positions[pos]
            if pos in self.ba_positions:
                ba = self.ba_positions[pos]
            elif pos in self.rcca_positions:
                ba = "RCCA {0}".format(self.rcca_positions[pos])
            else:
                ba = 'no BAs'
            if self.is_symmetric:
                instr = 'no instr'
            else:
                if pos in self.instr_positions:
                    instr = 'instr'
                else:
                    instr = 'no instr'
            lattice.setPosition(pos, self.assem.u_fuel[enr][ba][instr])
        lattice.finalize()

        self.u_coreLattice = lattice

